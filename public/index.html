<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MISTER AI | IPTV ULTRA PRO</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --neon-blue: #00f2ff;
            --dark-bg: #020617;
            --glass: rgba(30, 41, 59, 0.7);
            --error: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background: var(--dark-bg); color: white; height: 100vh; overflow: hidden; }

        .app-layout { display: grid; grid-template-columns: 380px 1fr; height: 100vh; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª */
        .sidebar { background: #0f172a; border-left: 1px solid #1e293b; display: flex; flex-direction: column; z-index: 10; }
        .sidebar-head { padding: 25px; background: linear-gradient(to bottom, #1e293b, transparent); }
        .logo { font-size: 1.6rem; font-weight: 900; color: var(--neon-blue); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }

        /* Ø£Ø²Ø±Ø§Ø± Ù…ØµØ·ÙÙ‰ Ø§Ù„Ù…Ù„ÙˆÙ†Ø© */
        .misterai-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .custom-btn { 
            background: var(--glass); border: 1px solid var(--neon-blue); color: var(--neon-blue);
            padding: 12px; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .custom-btn:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 15px var(--neon-blue); }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª */
        .channel-list { flex: 1; overflow-y: auto; padding: 15px; scrollbar-width: thin; }
        .chan-item { 
            display: flex; align-items: center; gap: 15px; padding: 12px; 
            background: var(--glass); margin-bottom: 10px; border-radius: 15px;
            cursor: pointer; transition: 0.2s; border: 1px solid transparent;
        }
        .chan-item:hover { border-color: var(--neon-blue); background: #1e293b; transform: translateX(-5px); }
        .chan-item img { width: 45px; height: 45px; border-radius: 10px; object-fit: contain; background: white; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø´ØºÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .player-main { display: flex; flex-direction: column; position: relative; background: #000; }
        .video-box { flex: 1; display: flex; align-items: center; justify-content: center; background: #000; position: relative; }
        video { width: 100%; max-height: 100vh; outline: none; box-shadow: 0 0 100px rgba(0, 242, 255, 0.1); }

        /* ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø®Ø·Ø£ */
        #errorOverlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 5;
        }

        .loader { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--neon-blue); border-radius: 50%; animation: spin 1s linear infinite; display: none; margin: 10px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @media (max-width: 900px) {
            .app-layout { grid-template-columns: 1fr; }
            .sidebar { height: 50vh; order: 2; }
            .player-main { height: 50vh; order: 1; }
        }
    </style>
</head>
<body>

<div class="app-layout">
    <aside class="sidebar">
        <div class="sidebar-head">
            <div class="logo"><i class="fas fa-microchip"></i> DZ-AI IPTV</div>
            
            <div class="misterai-grid">
                <button class="custom-btn" onclick="playMister(1)"><i class="fas fa-play"></i> Ù‚Ù†Ø§Ø© 1</button>
                <button class="custom-btn" onclick="playMister(2)"><i class="fas fa-play"></i> Ù‚Ù†Ø§Ø© 2</button>
                <button class="custom-btn" onclick="playMister(3)"><i class="fas fa-play"></i> Ù‚Ù†Ø§Ø© 3</button>
                <button class="custom-btn" onclick="playMister(4)"><i class="fas fa-play"></i> Ù‚Ù†Ø§Ø© 4</button>
            </div>

            <select id="sourceSelect" onchange="loadExternalM3U(this.value)" 
                style="width:100%; padding:12px; border-radius:10px; background:#1e293b; color:white; border:1px solid var(--neon-blue);">
                <option value="">-- Ø§Ø®ØªØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª --</option>
                <option value="https://iptv-org.github.io/iptv/languages/ara.m3u">ğŸŒ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="https://iptv-org.github.io/iptv/categories/sports.m3u">âš½ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©</option>
                <option value="https://iptv-org.github.io/iptv/countries/dz.m3u">ğŸ‡©ğŸ‡¿ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</option>
            </select>
            <div id="mainLoader" class="loader"></div>
        </div>

        <div class="channel-list" id="listBody">
            </div>
    </aside>

    <main class="player-main">
        <div class="video-box">
            <video id="iptvPlayer" controls playsinline poster="https://i.imgur.com/8DAriPs.png"></video>
            
            <div id="errorOverlay">
                <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--error);"></i>
                <p id="errorMsg" style="margin-top: 15px; text-align: center; padding: 0 20px;">Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹ Ø£Ùˆ ÙŠØªØ·Ù„Ø¨ VPN</p>
                <button class="custom-btn" style="margin-top: 20px;" onclick="document.getElementById('errorOverlay').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
        
        <div style="padding: 20px; background: #0f172a; border-top: 1px solid #1e293b;">
            <h2 id="liveTitle" style="color: var(--neon-blue);">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„...</h2>
            <p id="liveInfo" style="font-size: 0.8rem; opacity: 0.6; margin-top: 5px;"></p>
        </div>
    </main>
</div>

<script>
    const video = document.getElementById('iptvPlayer');
    const hls = new Hls();
    let channelData = [];

    // Ø±ÙˆØ§Ø¨Ø·Ùƒ Ø§Ù„Ø®Ø§ØµØ© - ØªØ£ÙƒØ¯ Ø£Ù†Ù‡Ø§ ØªØ¹Ù…Ù„ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
    const mySources = {
        1: "http://185.226.172.11:8080/mo3ad/mo3ad1.m3u8",
        2: "http://185.226.172.11:8080/mo3ad/mo3ad2.m3u8",
        3: "http://185.226.172.11:8080/mo3ad/mo3ad3.m3u8",
        4: "http://185.226.172.11:8080/mo3ad/mo3ad4.m3u8"
    };

    function playMister(id) {
        startStreaming(mySources[id], `Ù‚Ù†Ø§Ø© MisterAI Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© ${id}`);
    }

    async function loadExternalM3U(url) {
        if(!url) return;
        const loader = document.getElementById('mainLoader');
        const listBody = document.getElementById('listBody');
        
        loader.style.display = 'block';
        listBody.innerHTML = '';

        try {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Proxy Ù„ØªØ¬Ø§ÙˆØ² Ù‚ÙŠÙˆØ¯ CORS Ø§Ù„ØªÙŠ ØªÙ…Ù†Ø¹ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            const proxyUrl = "https://api.allorigins.win/raw?url=" + encodeURIComponent(url);
            const response = await fetch(proxyUrl);
            const data = await response.text();
            parseM3UContent(data);
        } catch (e) {
            alert("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ.");
        } finally {
            loader.style.display = 'none';
        }
    }

    function parseM3UContent(text) {
        const lines = text.split('\n');
        channelData = [];
        let currentItem = {};

        lines.forEach(line => {
            line = line.trim();
            if(line.startsWith('#EXTINF:')) {
                const info = line.split(',');
                currentItem.name = info[1] || "Ù‚Ù†Ø§Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©";
                const logoMatch = line.match(/tvg-logo="([^"]+)"/);
                currentItem.logo = logoMatch ? logoMatch[1] : 'https://via.placeholder.com/50?text=TV';
            } else if(line.startsWith('http')) {
                currentItem.url = line;
                channelData.push({...currentItem});
                currentItem = {};
            }
        });
        renderList(channelData);
    }

    function renderList(list) {
        const container = document.getElementById('listBody');
        container.innerHTML = list.map((ch, index) => `
            <div class="chan-item" onclick="startStreaming('${ch.url}', '${ch.name}')">
                <img src="${ch.logo}" onerror="this.src='https://via.placeholder.com/50?text=TV'">
                <div style="font-weight:bold;">${ch.name}</div>
            </div>
        `).join('');
    }

    function startStreaming(url, name) {
        const errorOverlay = document.getElementById('errorOverlay');
        errorOverlay.style.display = 'none';
        document.getElementById('liveTitle').innerText = name;
        document.getElementById('liveInfo').innerText = url;

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø®Ø·Ø£ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø§ ÙŠØ¹Ù…Ù„
        video.onerror = function() {
            errorOverlay.style.display = 'flex';
            document.getElementById('errorMsg').innerText = "Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„: " + name + "\n Ø§Ù„Ø±Ø§Ø¨Ø· Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…ØªÙˆÙ‚ÙØ§Ù‹ Ø£Ùˆ ÙŠØ­ØªØ§Ø¬ Ù…Ø´ØºÙ„ Ø®Ø§Øµ.";
        };

        if (Hls.isSupported()) {
            hls.destroy(); // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø´ØºÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ… ØªÙ…Ø§Ù…Ø§Ù‹
            const newHls = new Hls();
            newHls.loadSource(url);
            newHls.attachMedia(video);
            newHls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ HLS
            newHls.on(Hls.Events.ERROR, function (event, data) {
                if (data.fatal) {
                    errorOverlay.style.display = 'flex';
                }
            });
        } 
        else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.play();
        }
    }
</script>
</body>
</html>
